<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/dagger/blog/rss.xml" title="Dagger Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/dagger/blog/atom.xml" title="Dagger Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KDHSNBDXW8"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KDHSNBDXW8",{})</script><title data-react-helmet="true">Longbow+ | Dagger</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://raystack.github.io//dagger/docs/advance/longbow_plus"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Longbow+ | Dagger"><meta data-react-helmet="true" name="description" content="Longbow+ is an enhanced version of longbow. It is also used for long windowed aggregations. One of the limitations for longbow was the lack of support for complex data types. Longbow+ lets you select as many complex fields as required and it has its own DSL in place to query these complex fields. This currently works only for Kafka sink."><meta data-react-helmet="true" property="og:description" content="Longbow+ is an enhanced version of longbow. It is also used for long windowed aggregations. One of the limitations for longbow was the lack of support for complex data types. Longbow+ lets you select as many complex fields as required and it has its own DSL in place to query these complex fields. This currently works only for Kafka sink."><link data-react-helmet="true" rel="shortcut icon" href="/dagger/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://raystack.github.io//dagger/docs/advance/longbow_plus"><link data-react-helmet="true" rel="alternate" href="https://raystack.github.io//dagger/docs/advance/longbow_plus" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://raystack.github.io//dagger/docs/advance/longbow_plus" hreflang="x-default"><link rel="stylesheet" href="/dagger/assets/css/styles.618c758c.css">
<link rel="preload" href="/dagger/assets/js/runtime~main.38f5f07c.js" as="script">
<link rel="preload" href="/dagger/assets/js/main.ac84df79.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" style="background-color:#222;color:#eee" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">⭐️ If you like Dagger, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/raystack/dagger">GitHub</a>! ⭐</div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/dagger/"><img src="/dagger/img/logo-n.svg" alt="Dagger" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/dagger/img/logo-n.svg" alt="Dagger" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Dagger</b></a><a class="navbar__item navbar__link navbar__link--active" href="/dagger/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/dagger/blog">Blog</a><a class="navbar__item navbar__link" href="/dagger/help">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://bit.ly/2RzPbtn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link"></a><a href="https://github.com/raystack/dagger" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-item-github"></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">☾</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">☀️</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/dagger/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/dagger/docs/roadmap">Roadmap</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Guides</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concepts</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Advance</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/dagger/docs/advance/overview">Overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/dagger/docs/advance/pre_processor">Pre Processors</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/dagger/docs/advance/post_processor">Post Processors</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/dagger/docs/advance/longbow">Longbow</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/dagger/docs/advance/longbow_plus">Longbow+</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/dagger/docs/advance/DARTS">Darts</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/dagger/docs/advance/security">Security</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Usecases</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reference</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Examples</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Contribute</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Longbow+</h1></header><p>Longbow+ is an enhanced version of <a href="/dagger/docs/advance/longbow">longbow</a>. It is also used for long windowed aggregations. One of the limitations for longbow was the lack of support for complex data types. Longbow+ lets you select as many complex fields as required and it has its own DSL in place to query these complex fields. This currently works only for Kafka sink.</p><header><h1>Components</h1></header><p>Similar to longbow, longbow+ also has the following components.</p><ul><li><a href="/dagger/docs/advance/longbow_plus#longbow-writer">Longbow writer</a></li><li><a href="/dagger/docs/advance/longbow_plus#longbow-reader">Longbow reader</a></li></ul><p>But unlike longbow, the above two components are divided into multiple daggers instead of a single one. The main idea behind dividing this into two daggers is to resue the data published by longbow_writer by multiple longbow_reader for different use cases. In order to connect the two daggers, longbow_writer publishes a synchronization log having some metadata that can be consumed by multiple longbow_reader daggers. From the output of a longbow_reader, different daggers can be used in order to query the historical information as explained <a href="/dagger/docs/advance/longbow_plus#using-longbow-reader-output">here</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="longbow-writer"></a>Longbow writer<a class="hash-link" href="#longbow-writer" title="Direct link to heading">#</a></h2><p>LongbowWrite has two responsibilities, to write an incoming event to BigTable and then emit a resultant event containing metadata(like table name, input proto class name, longbow key, etc.) to a Kafka topic after each successful write. It uses Flink&#x27;s <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/dev/stream/operators/asyncio.html" target="_blank" rel="noopener noreferrer">Async IO</a> in order to make the network call.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="workflow"></a>Workflow<a class="hash-link" href="#workflow" title="Direct link to heading">#</a></h3><ul><li>Create a new table(if doesn&#x27;t exist) with the name same as Dagger job name or using <a href="/dagger/docs/reference/configuration#processor_longbow_gcp_project_id">PROCESSOR_LONGBOW_GCP_PROJECT_ID</a>.</li><li>Receives the record post SQL query processing.</li><li>Creates the Bigtable key by combining data from longbow_write_key, a delimiter, and reversing the event_timestamp. Timestamps are reversed in order to achieve lower latencies in scan query, more details <a href="https://cloud.google.com/bigtable/docs/schema-design#time-based" target="_blank" rel="noopener noreferrer">here</a>.</li><li>Creates the request by serializing all the remaining values(i.e apart from fields passed as configs) from SQL query using the <code>INPUT_SCHEMA_PROTO_CLASS</code> proto, and adding the serialized bytes in a single Bigtable row column named as <code>proto</code>.</li><li>Makes the request.</li><li>Passes the row after adding additional metadata fields like input_class_name, bigtable_table_id, longbow_read_key to the sink.</li><li>Configured Kafka sink publishes the data to Kafka.</li></ul><p><strong>Note:</strong> By default we create tables with retention of 3 months in Bigtable.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h3><p>In this example, let&#x27;s assume we have booking events in a Kafka cluster and we want to get information of all the order numbers, their driver ids and location(complex field) for customers in the last 30 days. Here customer_id will become longbow_write_key.</p><p><img src="/dagger/assets/images/longbowplus-writer-3b3161717425165a99b968b26b5b82ca.png"></p><p>Sample input schema for booking</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI protobuf"><pre tabindex="0" class="prism-code language-protobuf codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">message SampleBookingInfo {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  string order_number = 1;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  string order_url = 2;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Status.Enum status = 3;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp event_timestamp = 4;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  string customer_id = 5;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  string driver_id = 6;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Location location = 7;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI protobuf"><pre tabindex="0" class="prism-code language-protobuf codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">message Location {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  double latitude = 1;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  double longtitude = 2;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Sample output schema for longbow writer output</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI protobuf"><pre tabindex="0" class="prism-code language-protobuf codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">message SampleLongbowSynchronizer {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  string bigtable_table_id = 1;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  string input_class_name = 2;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  string longbow_read_key = 3;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp event_timestamp = 4;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>Note:</strong> The <code>longbow_write_key</code> is populated as <code>longbow_read_key</code> in the output topic in order to pass the key to longbow_reader.</p><p>Sample Query</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI SQL"><pre tabindex="0" class="prism-code language-SQL codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># here booking denotes the booking events stream with the sample input schema</span></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  CURRENT_TIMESTAMP AS event_timestamp,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  customer_id AS longbow_write_key,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  order_number,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  driver_id,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  location,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  rowtime AS rowtime</span></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  booking</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the above example, customer_id along with a delimiter and reversed timestamp will form the Bigtable row key. Values of order_number, driver_id and location will be serialized using SampleBookingInfo proto and will be inserted under <code>proto</code> column in the Bigtable row.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="configurations"></a>Configurations<a class="hash-link" href="#configurations" title="Direct link to heading">#</a></h3><p>Longbow+ writer is also entirely driven via SQL query like longbow, i.e. on the basis of the presence of certain columns we identify longbow+ writer parameters. Following configs should be passed via SQL query as shown in the above example.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="longbow_write_key"></a><code>longbow_write_key</code><a class="hash-link" href="#longbow_write_key" title="Direct link to heading">#</a></h4><p>The key from the input which should be used to create the row key for Bigtable. Longbow+ writer will be enabled only if this column is present.</p><ul><li>Example value: <code>customer_id</code></li><li>Type: <code>required</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="event_timestamp"></a><code>event_timestamp</code><a class="hash-link" href="#event_timestamp" title="Direct link to heading">#</a></h4><p>The timestamp to be used to build the Bigtable row keys.</p><ul><li>Example value: <code>CURRENT_TIMESTAMP</code></li><li>Type: <code>required</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="rowtime"></a><code>rowtime</code><a class="hash-link" href="#rowtime" title="Direct link to heading">#</a></h4><p>The time attribute column. Read more <a href="/dagger/docs/concepts/basics#rowtime">here</a>.</p><ul><li>Example value: <code>rowtime</code></li><li>Type: <code>required</code></li></ul><p>Longbow+ writer utilizes same global longbow configs. Details <a href="/dagger/docs/reference/configuration#longbow">here</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="longbow-reader"></a>Longbow reader<a class="hash-link" href="#longbow-reader" title="Direct link to heading">#</a></h2><p>It reads the output of LongbowWrite and fetches the data for a particular key and a time duration from BigTable. It creates accumulative data for a configurable duration for other Daggers to use. It pushes the result along with some metadata to another Kafka topic. It also uses Flink&#x27;s <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/dev/stream/operators/asyncio.html" target="_blank" rel="noopener noreferrer">Async IO</a> in order to make the network call.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="workflow-1"></a>Workflow<a class="hash-link" href="#workflow-1" title="Direct link to heading">#</a></h3><ul><li>Reads the output of LongbowWrite from Kafka topic.</li><li>Figures out the Bigtable row key from <code>longbow_read_key</code> column value.</li><li>Builds the scan request for Bigtable. We provide two configurable strategies for defining the range of the query.<ul><li><strong>Duration range:</strong> It will scan from the latest event&#x27;s timestamp to a provided duration.</li><li><strong>Absolute range:</strong> You can provide the absolute range by setting <a href="/dagger/docs/advance/longbow#longbow_latest">longbow_latest</a> and <a href="/dagger/docs/advance/longbow#longbow_earliest">longbow_earliest</a> in the SQL query.</li></ul></li><li>Makes the scan request and receives the result.</li><li>Parses the response and creates a list of values and adds them to <code>proto_data</code> column in the output. Thus every record post this stage will have its historical data within the same record.</li><li>Forwards the data to the sink.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="example-1"></a>Example<a class="hash-link" href="#example-1" title="Direct link to heading">#</a></h3><p>In this example, we are consuming the output from the longbow_writer example mentioned above.</p><p><img src="/dagger/assets/images/longbowplus-reader-a384627ee8f88bd89473d03b383c58a6.png"></p><p>Sample output schema for longbow reader output</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI protobuf"><pre tabindex="0" class="prism-code language-protobuf codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">message SampleLongbowReaderOutput {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated bytes proto_data = 1;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  string longbow_duration = 2;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  string longbow_read_key = 3;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  string input_class_name = 4;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp event_timestamp = 5;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Sample Query</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI SQL"><pre tabindex="0" class="prism-code language-SQL codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># here longbow_write denotes the events stream with the longbow writer output</span></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  *,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  longbow_read_key,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;14d&#x27; as longbow_duration</span></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  longbow_write</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the above example, proto_data field will contain a list of all the historical messages.</p><p><strong>Note:</strong> Select <code>longbow_read_key</code> explicitly in the query (even if you have selected *).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="configurations-1"></a>Configurations<a class="hash-link" href="#configurations-1" title="Direct link to heading">#</a></h3><p>Longbow+ reader is also entirely driven via SQL query like longbow, i.e. on the basis of the presence of certain columns we identify longbow+ reader parameters. Following configs should be passed via SQL query as shown in the above example.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="longbow_read_key"></a><code>longbow_read_key</code><a class="hash-link" href="#longbow_read_key" title="Direct link to heading">#</a></h4><p>The key using which Bigtable scan row keys will be created. Longbow+ reader will be enabled only if this column is present.</p><ul><li>Example value: <code>customer_id</code></li><li>Type: <code>required</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="event_timestamp-1"></a><code>event_timestamp</code><a class="hash-link" href="#event_timestamp-1" title="Direct link to heading">#</a></h4><p>The timestamp to be used to build the Bigtable scan row keys.</p><ul><li>Example value: <code>created_at</code></li><li>Type: <code>required</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="rowtime-1"></a><code>rowtime</code><a class="hash-link" href="#rowtime-1" title="Direct link to heading">#</a></h4><p>The time attribute column. Read more <a href="/dagger/docs/concepts/basics#rowtime">here</a>.</p><ul><li>Example value: <code>rowtime</code></li><li>Type: <code>required</code></li></ul><p>Longbow+ reader utilizes same global longbow configs. Details <a href="/dagger/docs/reference/configuration#longbow">here</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="using-longbow-reader-output"></a>Using longbow reader output<a class="hash-link" href="#using-longbow-reader-output" title="Direct link to heading">#</a></h2><p>Given that the output of longbow_reader will contain a list of bytes, it becomes hard to use it directly in the SQL query. So we added a few custom <a href="/dagger/docs/guides/use_udf">UDFs</a> in order to make this easy for the users. These UDFs simplify the Dagger query for consuming data from longbow reader. They consume the data which is in the form of bytes and do deserialization and filtering/field selection on top of it.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="field-selection"></a>Field Selection<a class="hash-link" href="#field-selection" title="Direct link to heading">#</a></h3><p>You can use <a href="/dagger/docs/reference/udfs#selectfields">SelectFields</a> UDF for this. You can select one of the fields from the output of longbow reader and either use it in the query or send it downstream for other systems to use. It returns an array of the selected data type.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="filtering"></a>Filtering<a class="hash-link" href="#filtering" title="Direct link to heading">#</a></h3><p>You can use <a href="/dagger/docs/reference/udfs#filters">Filters</a> UDF for this. This function is used with predicates that decide what data to keep. One example of the predicate is <code>CondEq</code>. You could use one or more predicates to filter data as per your requirements.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="condeq"></a>CondEq<a class="hash-link" href="#condeq" title="Direct link to heading">#</a></h4><p>One of the predicates to be used in Filters. This predicate allows you to equate the field with a specific value. Ex:<code>CondEq(‘status’, ‘Completed’)</code> helps filter function to filter data where status is completed. More info <a href="/dagger/docs/reference/udfs#condeq">here</a>.</p><p><strong>Note:</strong> It supports String, Integer &amp; Boolean data type.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="sample-query"></a>Sample Query<a class="hash-link" href="#sample-query" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI SQL"><pre tabindex="0" class="prism-code language-SQL codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># here longbow_read denotes the events stream with the longbow reader output</span></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ArrayAggregate(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      SelectFields(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          proto_data,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          input_class_name,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          &#x27;order_number&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      ),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;distinct.count&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;Other&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ) as distinct_orders</span></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  longbow_read</span></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  cardinality(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      SelectFields(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          proto_data,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          input_class_name,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          &#x27;order_number&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      ),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;distinct.count&#x27;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;Other&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ) &gt; 20</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the above query, we are outputting the number of distinct order_number where it is greater than 20.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/raystack/dagger/edit/master/docs/docs/advance/longbow_plus.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/dagger/docs/advance/longbow"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Longbow</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/dagger/docs/advance/DARTS"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Darts »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#longbow-writer" class="table-of-contents__link">Longbow writer</a><ul><li><a href="#workflow" class="table-of-contents__link">Workflow</a></li><li><a href="#example" class="table-of-contents__link">Example</a></li><li><a href="#configurations" class="table-of-contents__link">Configurations</a></li></ul></li><li><a href="#longbow-reader" class="table-of-contents__link">Longbow reader</a><ul><li><a href="#workflow-1" class="table-of-contents__link">Workflow</a></li><li><a href="#example-1" class="table-of-contents__link">Example</a></li><li><a href="#configurations-1" class="table-of-contents__link">Configurations</a></li></ul></li><li><a href="#using-longbow-reader-output" class="table-of-contents__link">Using longbow reader output</a><ul><li><a href="#field-selection" class="table-of-contents__link">Field Selection</a></li><li><a href="#filtering" class="table-of-contents__link">Filtering</a></li><li><a href="#sample-query" class="table-of-contents__link">Sample Query</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Products</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/raystack/optimus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Optimus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/raystack/firehose" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Firehose<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/raystack/raccoon" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Raccoon<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/raystack/stencil" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stencil<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/dagger/docs/intro">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/dagger/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/dagger/help">Help</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://bit.ly/2RzPbtn" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/raystack/dagger" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/dagger/assets/js/runtime~main.38f5f07c.js"></script>
<script src="/dagger/assets/js/main.ac84df79.js"></script>
</body>
</html>