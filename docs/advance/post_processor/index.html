<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/dagger/blog/rss.xml" title="Dagger Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/dagger/blog/atom.xml" title="Dagger Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KDHSNBDXW8"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KDHSNBDXW8",{})</script><title data-react-helmet="true">Post Processors | Dagger</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://odpf.github.io//dagger/docs/advance/post_processor"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Post Processors | Dagger"><meta data-react-helmet="true" name="description" content="Post Processors give the capability to do custom stream processing after the SQL processing is performed. Complex transformation, enrichment &amp; aggregation use cases are difficult to execute &amp; maintain using SQL. Post Processors solve this problem through code and/or configuration. This can be used to enrich the stream from external sources (HTTP, ElasticSearch, PostgresDB, GRPC), enhance data points using function or query and transform through user-defined code."><meta data-react-helmet="true" property="og:description" content="Post Processors give the capability to do custom stream processing after the SQL processing is performed. Complex transformation, enrichment &amp; aggregation use cases are difficult to execute &amp; maintain using SQL. Post Processors solve this problem through code and/or configuration. This can be used to enrich the stream from external sources (HTTP, ElasticSearch, PostgresDB, GRPC), enhance data points using function or query and transform through user-defined code."><link data-react-helmet="true" rel="shortcut icon" href="/dagger/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://odpf.github.io//dagger/docs/advance/post_processor"><link data-react-helmet="true" rel="alternate" href="https://odpf.github.io//dagger/docs/advance/post_processor" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://odpf.github.io//dagger/docs/advance/post_processor" hreflang="x-default"><link rel="stylesheet" href="/dagger/assets/css/styles.6b0e8585.css">
<link rel="preload" href="/dagger/assets/js/runtime~main.7ce6ea11.js" as="script">
<link rel="preload" href="/dagger/assets/js/main.ec596639.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" style="background-color:#222;color:#eee" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">⭐️ If you like Dagger, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/odpf/dagger">GitHub</a>! ⭐</div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/dagger/"><img src="/dagger/img/logo-n.svg" alt="Dagger" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/dagger/img/logo-n.svg" alt="Dagger" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Dagger</b></a><a class="navbar__item navbar__link navbar__link--active" href="/dagger/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/dagger/blog">Blog</a><a class="navbar__item navbar__link" href="/dagger/help">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://bit.ly/2RzPbtn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link"></a><a href="https://github.com/odpf/dagger" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-item-github"></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">☾</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">☀️</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/dagger/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/dagger/docs/roadmap">Roadmap</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Guides</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concepts</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Advance</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/dagger/docs/advance/overview">Overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/dagger/docs/advance/pre_processor">Pre Processors</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/dagger/docs/advance/post_processor">Post Processors</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/dagger/docs/advance/longbow">Longbow</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/dagger/docs/advance/longbow_plus">Longbow+</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/dagger/docs/advance/DARTS">Darts</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Usecases</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reference</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Contribute</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Post Processors</h1></header><p>Post Processors give the capability to do custom stream processing after the SQL processing is performed. Complex transformation, enrichment &amp; aggregation use cases are difficult to execute &amp; maintain using SQL. Post Processors solve this problem through code and/or configuration. This can be used to enrich the stream from external sources (HTTP, ElasticSearch, PostgresDB, GRPC), enhance data points using function or query and transform through user-defined code.</p><p>All the post processors mentioned in this doc can be applied in a sequential manner, which enables you to get information from multiple different external data sources and apply as many transformers as required. The output of one processor will be the input for the other and the final result will be pushed to the configured sink.</p><header><h1>Flow of Execution</h1></header><p>In the flow of Post Processors, all types of processors viz; External Post Processors, Internal Post Processors and Transformers can be applied sequentially via config. The output of one Post Processor will be the input of the next one. The input SQL is executed first before any of the Post Processors and the Post Processors run only on the output of the SQL. Here is an example of a simple use case that can be solved using Post Processor and sample Data flow Diagrams for that.</p><ul><li>Let&#x27;s assume that you want to find cashback given for a particular order number from an external API endpoint. You can use an <a href="/dagger/docs/advance/post_processor#http">HTTP external post-processor</a> for this. Here is a basic Data flow diagram.</li></ul><p><img src="/dagger/assets/images/external-http-post-processor-058061066d4696892bae0347e772e83a.png"></p><ul><li>In the above example, assume you also want to output the information of customer_id and amount which are fields from input proto. <a href="/dagger/docs/advance/post_processor#internal-post-processor">Internal Post Processor</a> can be used for selecting these fields from the input stream.</li></ul><p><img src="/dagger/assets/images/external-internal-post-processor-1f9f631b1a47ddd612b6025734327cc1.png"></p><ul><li><p>After getting customer_id, amount and cashback amount, you may want to round off the cashback amount. For this, you can write a custom <a href="/dagger/docs/guides/use_transformer">transformer</a> which is a simple Java Flink Map function to calculate the round-off amount.</p><p><strong>Note:</strong> All the above processors are chained sequentially on the output of the previous processor. The order of execution is determined via the order provided in JSON config.</p></li></ul><p><img src="/dagger/assets/images/external-internal-transformer-post-processor-29bac9755b46a267096a2a935f3c773f.png"></p><header><h1>Types of Post Processors</h1></header><p>There are three types of Post Processors :</p><ul><li><a href="/dagger/docs/advance/post_processor#external-post-processor">External Post Processor</a></li><li><a href="/dagger/docs/advance/post_processor#internal-post-processor">Internal Post Processor</a></li><li><a href="/dagger/docs/advance/post_processor#transformers">Transformers</a></li></ul><p>Post Processors are entirely configuration driven. All the Post Processor related configs should be configured as part of <a href="/dagger/docs/reference/configuration#processor_postprocessor_config">PROCESSOR_POSTPROCESSOR_CONFIG</a> JSON under Settings in Dagger creation flow. Multiple Post Processors can be combined in the same configuration and applied to a single Dagger.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="external-post-processor"></a>External Post Processor<a class="hash-link" href="#external-post-processor" title="Direct link to heading">#</a></h2><p>External Post Processor is the one that connects to an external data source to fetch data in an async manner and perform enrichment of the stream message. These kinds of Post Processors use Flink’s API for asynchronous I/O with external data stores. For more details on Flink’s Async I/O find the doc <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/dev/stream/operators/asyncio.html" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Currently, we are supporting four external sources.</p><ul><li><a href="/dagger/docs/advance/post_processor#elasticsearch">Elasticsearch</a></li><li><a href="/dagger/docs/advance/post_processor#http">HTTP</a></li><li><a href="/dagger/docs/advance/post_processor#postgres">Postgres</a></li><li><a href="/dagger/docs/advance/post_processor#grpc">GRPC</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="elasticsearch"></a><strong>Elasticsearch</strong><a class="hash-link" href="#elasticsearch" title="Direct link to heading">#</a></h3><p>This allows you to enrich your data stream with the data on any remote <a href="https://www.elastic.co/" target="_blank" rel="noopener noreferrer">Elasticsearch</a>. For example, let&#x27;s say you have payment transaction logs in the input stream but user profile information in Elasticsearch, then you can use this post processor to get the profile information in each record.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="workflow"></a>Workflow<a class="hash-link" href="#workflow" title="Direct link to heading">#</a></h4><p>On applying only this post processor, dagger will perform the following operations on a single message in happy path</p><ul><li>Consume the message from configured Kafka stream.</li><li>Apply the SQL query configured.</li><li>Generate the endpoint URL using <a href="/dagger/docs/advance/post_processor#endpoint_pattern">endpoint_pattern</a> and <a href="/dagger/docs/advance/post_processor#endpoint_variables">endpoint_variables</a>.</li><li>Make the Elasticsearch call.</li><li>Read the response from Elasticsearch and populate the message according to <a href="/dagger/docs/advance/post_processor#output_mapping">output_mapping</a>.</li><li>Push the enriched message to configured sink.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="configuration"></a>Configuration<a class="hash-link" href="#configuration" title="Direct link to heading">#</a></h4><p>Following variables need to be configured as part of <a href="/dagger/docs/reference/configuration#processor_postprocessor_config">PROCESSOR_POSTPROCESSOR_CONFIG</a> JSON</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="host"></a><code>host</code><a class="hash-link" href="#host" title="Direct link to heading">#</a></h5><p>IP(s) of the nodes/haproxy.</p><ul><li>Example value: <code>localhost</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="port"></a><code>port</code><a class="hash-link" href="#port" title="Direct link to heading">#</a></h5><p>Port exposed for the same.</p><ul><li>Example value: <code>9200</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="user"></a><code>user</code><a class="hash-link" href="#user" title="Direct link to heading">#</a></h5><p>Username for Elasticsearch.</p><ul><li>Example value: <code>testuser</code></li><li>Type: <code>optional</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="password"></a><code>password</code><a class="hash-link" href="#password" title="Direct link to heading">#</a></h5><p>Password for Elasticsearch.</p><ul><li>Example value: <code>test</code></li><li>Type: <code>optional</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="endpoint_pattern"></a><code>endpoint_pattern</code><a class="hash-link" href="#endpoint_pattern" title="Direct link to heading">#</a></h5><p>String template for the endpoint. This will be appended to the host to create the final URL.</p><ul><li>Example value: <code>/customers/customer/%s</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="endpoint_variables"></a><code>endpoint_variables</code><a class="hash-link" href="#endpoint_variables" title="Direct link to heading">#</a></h5><p>Comma-separated list of variables used for populating identifiers in endpoint_pattern.</p><ul><li>Example value: <code>customer_id</code></li><li>Type: <code>optional</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="retain_response_type"></a><code>retain_response_type</code><a class="hash-link" href="#retain_response_type" title="Direct link to heading">#</a></h5><p>If true it will not cast the response from ES to output proto schema. The default behaviour is to cast the response to the output proto schema.</p><ul><li>Example value: <code>false</code></li><li>Type: <code>optional</code></li><li>Default value: <code>false</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="retry_timeout"></a><code>retry_timeout</code><a class="hash-link" href="#retry_timeout" title="Direct link to heading">#</a></h5><p>Timeout between request retries in ms.</p><ul><li>Example value: <code>5000</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="socket_timeout"></a><code>socket_timeout</code><a class="hash-link" href="#socket_timeout" title="Direct link to heading">#</a></h5><p>The time waiting for data after establishing the connection in ms; maximum time of inactivity between two data packets.</p><ul><li>Example value: <code>6000</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="connect_timeout"></a><code>connect_timeout</code><a class="hash-link" href="#connect_timeout" title="Direct link to heading">#</a></h5><p>The timeout value for ES client in ms.</p><ul><li>Example value: <code>5000</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="capacity"></a><code>capacity</code><a class="hash-link" href="#capacity" title="Direct link to heading">#</a></h5><p>This parameter(Async I/O capacity) defines how many max asynchronous requests may be in progress at the same time.</p><ul><li>Example value: <code>30</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="output_mapping"></a><code>output_mapping</code><a class="hash-link" href="#output_mapping" title="Direct link to heading">#</a></h5><p>Mapping of fields in output Protos goes here. Based on which part of the response data to use, you can configure the path, and output message fields will be populated accordingly. You can use <a href="https://github.com/json-path/JsonPath" target="_blank" rel="noopener noreferrer">JsonPath</a> to select fields from json response.</p><ul><li>Example value: <code>{&quot;customer_profile&quot;:{ &quot;path&quot;:&quot;$._source&quot;}}</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="fail_on_errors"></a><code>fail_on_errors</code><a class="hash-link" href="#fail_on_errors" title="Direct link to heading">#</a></h5><p>A flag for deciding whether the job should fail on encountering errors or not. If set false the job won’t fail and enrich with empty fields otherwise the job will fail.</p><ul><li>Example value: <code>false</code></li><li>Type: <code>optional</code></li><li>Default value: <code>false</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="metric_id"></a><code>metric_id</code><a class="hash-link" href="#metric_id" title="Direct link to heading">#</a></h5><p>Identifier tag for metrics for every post processor applied. If not given it will use indexes of post processors in the JSON config.</p><ul><li>Example value: <code>test_id</code></li><li>Type: <code>optional</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="sample-query"></a>Sample Query<a class="hash-link" href="#sample-query" title="Direct link to heading">#</a></h4><p>You can select the fields that you want to get from the input stream or you want to use for making the request.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI SQL"><pre tabindex="0" class="prism-code language-SQL codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT customer_id from `booking`</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="sample-configuration"></a>Sample Configuration<a class="hash-link" href="#sample-configuration" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_ENABLE = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_CONFIG = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;external_source&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;es&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;host&quot;: &quot;127.0.0.1&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;port&quot;: &quot;9200&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;endpoint_pattern&quot;: &quot;/customers/customer/%s&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;endpoint_variables&quot;: &quot;customer_id&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;retry_timeout&quot;: &quot;5000&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;socket_timeout&quot;: &quot;6000&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;stream_timeout&quot;: &quot;5000&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;connect_timeout&quot;: &quot;5000&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;capacity&quot;: &quot;30&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;output_mapping&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;customer_profile&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;path&quot;: &quot;$._source&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>Note:</strong> Though it is subjective to a lot of factors like data in ES, throughput in Kafka, size of ES cluster. A good thumb of rule is to make index call rather than queries to ES for fetching the data.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="http"></a><strong>HTTP</strong><a class="hash-link" href="#http" title="Direct link to heading">#</a></h3><p>HTTP Post Processor connects to an external API endpoint and does enrichment based on data from the response of the API call. Currently, we support POST and GET verbs for the API call.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="workflow-1"></a>Workflow<a class="hash-link" href="#workflow-1" title="Direct link to heading">#</a></h4><p>On applying only this post processor, dagger will perform the following operations on a single message in happy path</p><ul><li>Consume the message from configured Kafka stream.</li><li>Apply the SQL query configured.</li><li>Generate the endpoint URL in case of GET call or request body in case of POST call using <a href="/dagger/docs/advance/post_processor#request_pattern">request_pattern</a> and <a href="/dagger/docs/advance/post_processor#request_variables">request_variables</a>.</li><li>Make the HTTP call.</li><li>Read the response from HTTP API and populate the message according to <a href="/dagger/docs/advance/post_processor#output_mapping-1">output_mapping</a>.</li><li>Push the enriched message to configured sink.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="configuration-1"></a>Configuration<a class="hash-link" href="#configuration-1" title="Direct link to heading">#</a></h4><p>Following variables need to be configured as part of <a href="/dagger/docs/reference/configuration#processor_postprocessor_config">PROCESSOR_POSTPROCESSOR_CONFIG</a> JSON</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="endpoint"></a><code>endpoint</code><a class="hash-link" href="#endpoint" title="Direct link to heading">#</a></h5><p>API endpoint. For POST call, URL will be just the endpoint. For GET, URL will be a combination of endpoint and request pattern.</p><ul><li>Example value: <code>http://127.0.0.1/api/customer</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="verb"></a><code>verb</code><a class="hash-link" href="#verb" title="Direct link to heading">#</a></h5><p>HTTP verb (currently support POST and GET).</p><ul><li>Example value: <code>GET</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="request_pattern"></a><code>request_pattern</code><a class="hash-link" href="#request_pattern" title="Direct link to heading">#</a></h5><p>Template for the body in case of POST and endpoint path in case of GET.</p><ul><li>Example value: <code>/customers/customer/%s</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="request_variables"></a><code>request_variables</code><a class="hash-link" href="#request_variables" title="Direct link to heading">#</a></h5><p>List of comma-separated parameters to be replaced in request_pattern, these variables must be present in the input proto and selected via the SQL query.</p><ul><li>Example value: <code>customer_id</code></li><li>Type: <code>optional</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="header_pattern"></a><code>header_pattern</code><a class="hash-link" href="#header_pattern" title="Direct link to heading">#</a></h5><p>Template for the dynamic headers.</p><ul><li>Example value: <code>{&quot;key&quot;: &quot;%s&quot;}</code></li><li>Type: <code>optional</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="header_variables"></a><code>header_variables</code><a class="hash-link" href="#header_variables" title="Direct link to heading">#</a></h5><p>List of comma-separated parameters to be replaced in header_pattern, these variables must be present in the input proto and selected via the SQL query.</p><ul><li>Example value: <code>customer_id</code></li><li>Type: <code>optional</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="stream_timeout"></a><code>stream_timeout</code><a class="hash-link" href="#stream_timeout" title="Direct link to heading">#</a></h5><p>The timeout value for the stream in ms.</p><ul><li>Example value: <code>5000</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="connect_timeout-1"></a><code>connect_timeout</code><a class="hash-link" href="#connect_timeout-1" title="Direct link to heading">#</a></h5><p>The timeout value for HTTP client in ms.</p><ul><li>Example value: <code>5000</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="fail_on_errors-1"></a><code>fail_on_errors</code><a class="hash-link" href="#fail_on_errors-1" title="Direct link to heading">#</a></h5><p>A flag for deciding whether the job should fail on encountering errors(timeout and status codes apart from 2XX) or not. If set false the job won’t fail and enrich with empty fields otherwise the job will fail.</p><ul><li>Example value: <code>false</code></li><li>Type: <code>optional</code></li><li>Default value: <code>false</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="capacity-1"></a><code>capacity</code><a class="hash-link" href="#capacity-1" title="Direct link to heading">#</a></h5><p>This parameter(Async I/O capacity) defines how many max asynchronous requests may be in progress at the same time.</p><ul><li>Example value: <code>30</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="headers"></a><code>headers</code><a class="hash-link" href="#headers" title="Direct link to heading">#</a></h5><p>Key-value pairs for adding headers to the request.</p><ul><li>Example value: <code>{&quot;content-type&quot;: &quot;application/json&quot;}</code></li><li>Type: <code>optional</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="retain_response_type-1"></a><code>retain_response_type</code><a class="hash-link" href="#retain_response_type-1" title="Direct link to heading">#</a></h5><p>If true it will not cast the response from HTTP to output proto schema. The default behaviour is to cast the response to the output proto schema.</p><ul><li>Example value: <code>false</code></li><li>Type: <code>optional</code></li><li>Default value: <code>false</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="output_mapping-1"></a><code>output_mapping</code><a class="hash-link" href="#output_mapping-1" title="Direct link to heading">#</a></h5><p>Mapping for all the fields we need to populate from the API response providing a path to fetch the required field from the response body. You can use <a href="https://github.com/json-path/JsonPath" target="_blank" rel="noopener noreferrer">JsonPath</a> to select fields from json response.</p><ul><li>Example value: <code>{&quot;customer_profile&quot;:{ &quot;path&quot;:&quot;$._source&quot;}}</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="metric_id-1"></a><code>metric_id</code><a class="hash-link" href="#metric_id-1" title="Direct link to heading">#</a></h5><p>Identifier tag for metrics for every post processor applied. If not given it will use indexes of post processors in the JSON config.</p><ul><li>Example value: <code>test_id</code></li><li>Type: <code>optional</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="sample-query-1"></a>Sample Query<a class="hash-link" href="#sample-query-1" title="Direct link to heading">#</a></h4><p>You can select the fields that you want to get from the input stream or you want to use for making the request.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI SQL"><pre tabindex="0" class="prism-code language-SQL codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT customer_id from `booking`</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="sample-configuration-for-get"></a>Sample Configuration for GET<a class="hash-link" href="#sample-configuration-for-get" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_ENABLE = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_CONFIG = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;external_source&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;http&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;endpoint&quot;: &quot;http://127.0.0.1&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;verb&quot;: &quot;get&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;request_pattern&quot;: &quot;/customers/customer/%s&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;request_variables&quot;: &quot;customer_id&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;header_pattern&quot;: &quot;{\&quot;Header_Key\&quot;: \&quot;%s\&quot;}&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;header_variables&quot;: &quot;wallet_id&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;stream_timeout&quot;: &quot;5000&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;connect_timeout&quot;: &quot;5000&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;fail_on_errors&quot;: &quot;false&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;capacity&quot;: &quot;30&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;headers&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;content-type&quot;: &quot;application/json&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;output_mapping&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;customer_profile&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;path&quot;: &quot;$._source&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>Note:</strong> In case you want to use all the fields along with a modified/nested field you can use “select *, modified_field as custom_column_name from data_stream”.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="sample-configuration-for-post"></a>Sample Configuration for POST<a class="hash-link" href="#sample-configuration-for-post" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_ENABLE = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_CONFIG = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;external_source&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;http&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;endpoint&quot;: &quot;http://127.0.0.1/customer&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;verb&quot;: &quot;post&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;request_pattern&quot;: &quot;{&#x27;key&#x27;: \&quot;%s\&quot;}&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;request_variables&quot;: &quot;customer_id&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;stream_timeout&quot;: &quot;5000&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;connect_timeout&quot;: &quot;5000&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;fail_on_errors&quot;: &quot;false&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;capacity&quot;: &quot;30&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;headers&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;content-type&quot;: &quot;application/json&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;output_mapping&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;test_field&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;path&quot;: &quot;$._source&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>Note:</strong> Post request patterns support both primitive and complex data types. But for complex objects, you need to remove the quotes from the selector ( <code>%s</code>). So in the case of a primitive datapoint of string the selector will be (<code>”%s”</code>) whereas for complex fields it will be (<code>%s</code>).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="postgres"></a><strong>Postgres</strong><a class="hash-link" href="#postgres" title="Direct link to heading">#</a></h3><p>This allows you to enrich your data stream with the data on any remote <a href="https://www.postgresql.org" target="_blank" rel="noopener noreferrer">Postgres</a>. For example, let&#x27;s say you have payment transaction logs in the input stream but user profile information in Postgres, then you can use this post processor to get the profile information in each record. Currently, we support enrichment from PostgresDB queries that result in a single row from DB.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="workflow-2"></a>Workflow<a class="hash-link" href="#workflow-2" title="Direct link to heading">#</a></h4><p>On applying only this post processor, dagger will perform the following operations on a single message in happy path</p><ul><li>Consume the message from configured Kafka stream.</li><li>Apply the SQL query configured.</li><li>Generate the Postgres query using <a href="/dagger/docs/advance/post_processor#query_pattern">query_pattern</a> and <a href="/dagger/docs/advance/post_processor#query_variables">query_variables</a>.</li><li>Make the Postgres call.</li><li>Read the response from Postgres and populate the message according to <a href="/dagger/docs/advance/post_processor#output_mapping-2">output_mapping</a>.</li><li>Push the enriched message to configured sink.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="configuration-2"></a>Configuration<a class="hash-link" href="#configuration-2" title="Direct link to heading">#</a></h4><p>Following variables need to be configured as part of <a href="/dagger/docs/reference/configuration#processor_postprocessor_config">PROCESSOR_POSTPROCESSOR_CONFIG</a> JSON</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="host-1"></a><code>host</code><a class="hash-link" href="#host-1" title="Direct link to heading">#</a></h5><p>IP(s) of the nodes/haproxy.</p><ul><li>Example value: <code>http://127.0.0.1</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="port-1"></a><code>port</code><a class="hash-link" href="#port-1" title="Direct link to heading">#</a></h5><p>Port exposed for the same.</p><ul><li>Example value: <code>5432</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="user-1"></a><code>user</code><a class="hash-link" href="#user-1" title="Direct link to heading">#</a></h5><p>Username for Postgres.</p><ul><li>Example value: <code>testuser</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="password-1"></a><code>password</code><a class="hash-link" href="#password-1" title="Direct link to heading">#</a></h5><p>Password for the particular user.</p><ul><li>Example value: <code>test</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="database"></a><code>database</code><a class="hash-link" href="#database" title="Direct link to heading">#</a></h5><p>Postgres database name.</p><ul><li>Example value: <code>testdb</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="query_pattern"></a><code>query_pattern</code><a class="hash-link" href="#query_pattern" title="Direct link to heading">#</a></h5><p>SQL query pattern to populate the data from PostgresDB.</p><ul><li>Example value: <code>select email, phone from public.customers where customer_id = &#x27;%s&#x27;</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="query_variables"></a><code>query_variables</code><a class="hash-link" href="#query_variables" title="Direct link to heading">#</a></h5><p>This is a comma-separated list (without any whitespaces in between) of parameters to be replaced in the query_pattern, and these variables must be present in the input proto.</p><ul><li>Example value: <code>customer_id</code></li><li>Type: <code>optional</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="stream_timeout-1"></a><code>stream_timeout</code><a class="hash-link" href="#stream_timeout-1" title="Direct link to heading">#</a></h5><p>The timeout value for the stream in ms.</p><ul><li>Example value: <code>25000</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="idle_timeout"></a><code>idle_timeout</code><a class="hash-link" href="#idle_timeout" title="Direct link to heading">#</a></h5><p>The timeout value for Postgres connection in ms.</p><ul><li>Example value: <code>25000</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="connect_timeout-2"></a><code>connect_timeout</code><a class="hash-link" href="#connect_timeout-2" title="Direct link to heading">#</a></h5><p>The timeout value for client in ms.</p><ul><li>Example value: <code>25000</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="fail_on_errors-2"></a><code>fail_on_errors</code><a class="hash-link" href="#fail_on_errors-2" title="Direct link to heading">#</a></h5><p>A flag for deciding whether the job should fail on encountering errors or not. If set false the job won’t fail and enrich with empty fields otherwise the job will fail.</p><ul><li>Example value: <code>false</code></li><li>Type: <code>optional</code></li><li>Default value: <code>false</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="capacity-2"></a><code>capacity</code><a class="hash-link" href="#capacity-2" title="Direct link to heading">#</a></h5><p>This parameter(Async I/O capacity) defines how many max asynchronous requests may be in progress at the same time.</p><ul><li>Example value: <code>30</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="retain_response_type-2"></a><code>retain_response_type</code><a class="hash-link" href="#retain_response_type-2" title="Direct link to heading">#</a></h5><p>If true it will not cast the response from Postgres Query to output proto schema. The default behaviour is to cast the response to the output proto schema.</p><ul><li>Example value: <code>false</code></li><li>Type: <code>optional</code></li><li>Default value: <code>false</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="output_mapping-2"></a><code>output_mapping</code><a class="hash-link" href="#output_mapping-2" title="Direct link to heading">#</a></h5><p>Mapping of fields in output proto goes here. Based on which part of the response data to use, you can configure the path, and output message fields will be populated accordingly.</p><ul><li>Example value: <code>{&quot;customer_email&quot;: &quot;email&quot;,&quot;customer_phone&quot;: &quot;phone”}</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="metric_id-2"></a><code>metric_id</code><a class="hash-link" href="#metric_id-2" title="Direct link to heading">#</a></h5><p>Identifier tag for metrics for every post processor applied. If not given it will use indexes of post processors in the JSON config.</p><ul><li>Example value: <code>test_id</code></li><li>Type: <code>optional</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="sample-query-2"></a>Sample Query<a class="hash-link" href="#sample-query-2" title="Direct link to heading">#</a></h4><p>You can select the fields that you want to get from the input stream or you want to use for making the request.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI SQL"><pre tabindex="0" class="prism-code language-SQL codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT customer_id from `booking`</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="sample-configuration-1"></a>Sample Configuration<a class="hash-link" href="#sample-configuration-1" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_ENABLE = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_CONFIG = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;external_source&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;pg&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;host&quot;: &quot;http://127.0.0.1&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;port&quot;: &quot;5432&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;user&quot;: &quot;test&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;password&quot;: &quot;test&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;database&quot;: &quot;my_db&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;capacity&quot;: &quot;30&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;stream_timeout&quot;: &quot;25000&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;connect_timeout&quot;: &quot;25000&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;idle_timeout&quot;: &quot;25000&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;query_pattern&quot;: &quot;select email, phone from public.customers where customer_id = &#x27;%s&#x27;&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;query_variables&quot;: &quot;customer_id&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;output_mapping&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;customer_email&quot;: &quot;email&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;customer_phone&quot;: &quot;phone”</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;fail_on_errors&quot;: &quot;true&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>Note:</strong> If you want to use % as a special character in your Postgres query, you’ll need to provide an additional % with it as an escape character so that Java doesn’t take it as a string formatter and try to format it, which in turn might end up in invalid format exception.
E.g. &quot;select email, phone from public.customers where name like &#x27;%%smith&#x27;&quot;</p><p><strong>Note:</strong> Please add relevant indexing in the database to ensure adequate performance.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="grpc"></a><strong>GRPC</strong><a class="hash-link" href="#grpc" title="Direct link to heading">#</a></h3><p>This enables you to enrich the input streams with any information available via remote <a href="https://grpc.io/" target="_blank" rel="noopener noreferrer">gRPC</a> server. For example let&#x27;s say you have payment transaction logs in the input stream but user profile information available via a gRPC service, then you can use this post processor to get the profile information in each record. Currently, we support only Unary calls.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="workflow-3"></a>Workflow<a class="hash-link" href="#workflow-3" title="Direct link to heading">#</a></h4><p>On applying only this post processor, dagger will perform the following operations on a single message in happy path</p><ul><li>Consume the message from configured Kafka stream.</li><li>Apply the SQL query configured.</li><li>Generate the gRPC request using <a href="/dagger/docs/advance/post_processor#request_pattern-1">request_pattern</a> and <a href="/dagger/docs/advance/post_processor#request_variables-1">request_variables</a>.</li><li>Make the gRPC call.</li><li>Read the response from gRPC API and populate the message according to <a href="/dagger/docs/advance/post_processor#output_mapping-3">output_mapping</a>.</li><li>Push the enriched message to configured sink.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="configuration-3"></a>Configuration<a class="hash-link" href="#configuration-3" title="Direct link to heading">#</a></h4><p>Following variables need to be configured as part of <a href="/dagger/docs/reference/configuration#processor_postprocessor_config">PROCESSOR_POSTPROCESSOR_CONFIG</a> JSON</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="endpoint-1"></a><code>endpoint</code><a class="hash-link" href="#endpoint-1" title="Direct link to heading">#</a></h5><p>Hostname of the gRPC endpoint.</p><ul><li>Example value: <code>localhost</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="service_port"></a><code>service_port</code><a class="hash-link" href="#service_port" title="Direct link to heading">#</a></h5><p>Port exposed for the service.</p><ul><li>Example value: <code>5000</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="grpc_stencil_url"></a><code>grpc_stencil_url</code><a class="hash-link" href="#grpc_stencil_url" title="Direct link to heading">#</a></h5><p>Endpoint where request and response proto descriptors are present. If not there, it will try to find from the given stencil_url of the input and output proto of Dagger.</p><ul><li>Example value: <code>http://localhost:9000/proto-descriptors/latest</code></li><li>Type: <code>optional</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="grpc_request_proto_schema"></a><code>grpc_request_proto_schema</code><a class="hash-link" href="#grpc_request_proto_schema" title="Direct link to heading">#</a></h5><p>Proto schema for the request for the gRPC endpoint.</p><ul><li>Example value: <code>io.grpc.test.Request</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="grpc_response_proto_schema"></a><code>grpc_response_proto_schema</code><a class="hash-link" href="#grpc_response_proto_schema" title="Direct link to heading">#</a></h5><p>Proto schema for the response from the gRPC endpoint.</p><ul><li>Example value: <code>io.grpc.test.Response</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="grpc_method_url"></a><code>grpc_method_url</code><a class="hash-link" href="#grpc_method_url" title="Direct link to heading">#</a></h5><p>Url of the gRPC method exposed.</p><ul><li>Example value: <code>testserver.test/ReturnResponse</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="request_pattern-1"></a><code>request_pattern</code><a class="hash-link" href="#request_pattern-1" title="Direct link to heading">#</a></h5><p>JSON Pattern for the request.</p><ul><li>Example value: <code>{&#x27;key&#x27;: %s}</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="request_variables-1"></a><code>request_variables</code><a class="hash-link" href="#request_variables-1" title="Direct link to heading">#</a></h5><p>This is a comma-separated list of parameters to be replaced in the request_pattern, and these variables must be present in the input proto.</p><ul><li>Example value: <code>customer_id</code></li><li>Type: <code>optional</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="stream_timeout-2"></a><code>stream_timeout</code><a class="hash-link" href="#stream_timeout-2" title="Direct link to heading">#</a></h5><p>The timeout value for the stream in ms.</p><ul><li>Example value: <code>5000</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="connect_timeout-3"></a><code>connect_timeout</code><a class="hash-link" href="#connect_timeout-3" title="Direct link to heading">#</a></h5><p>The timeout value for gRPC client in ms.</p><ul><li>Example value: <code>5000</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="fail_on_errors-3"></a><code>fail_on_errors</code><a class="hash-link" href="#fail_on_errors-3" title="Direct link to heading">#</a></h5><p>A flag for deciding whether the job should fail on encountering errors or not. If set false the job won’t fail and enrich with empty fields otherwise the job will fail.</p><ul><li>Example value: <code>false</code></li><li>Type: <code>optional</code></li><li>Default value: <code>false</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="capacity-3"></a><code>capacity</code><a class="hash-link" href="#capacity-3" title="Direct link to heading">#</a></h5><p>This parameter(Async I/O capacity) defines how many asynchronous requests may be in progress at the same time.</p><ul><li>Example value: <code>30</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="headers-1"></a><code>headers</code><a class="hash-link" href="#headers-1" title="Direct link to heading">#</a></h5><p>Key-value pairs for adding headers to the request.</p><ul><li>Example value: <code>{&#x27;key&#x27;: &#x27;value&#x27;}</code></li><li>Type: <code>optional</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="retain_response_type-3"></a><code>retain_response_type</code><a class="hash-link" href="#retain_response_type-3" title="Direct link to heading">#</a></h5><p>If true it will not cast the response from gRPC endpoint to output proto schema. The default behaviour is to cast the response to the output proto schema.</p><ul><li>Example value: <code>false</code></li><li>Type: <code>optional</code></li><li>Default value: <code>false</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="output_mapping-3"></a><code>output_mapping</code><a class="hash-link" href="#output_mapping-3" title="Direct link to heading">#</a></h5><p>Mapping of fields in output proto goes here. Based on which part of the response data to use, you can configure the path, and output message fields will be populated accordingly. You can use <a href="https://github.com/json-path/JsonPath" target="_blank" rel="noopener noreferrer">JsonPath</a> to select fields from json response.</p><ul><li>Example value: <code>{&quot;customer_profile&quot;:{ &quot;path&quot;:&quot;$._source&quot;}}</code></li><li>Type: <code>required</code></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_y2LR" id="metric_id-3"></a><code>metric_id</code><a class="hash-link" href="#metric_id-3" title="Direct link to heading">#</a></h5><p>Identifier tag for metrics for every post processor applied. If not given it will use indexes of post processors in the JSON config.</p><ul><li>Example value: <code>test_id</code></li><li>Type: <code>optional</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="sample-query-3"></a>Sample Query<a class="hash-link" href="#sample-query-3" title="Direct link to heading">#</a></h4><p>You can select the fields that you want to get from the input stream or you want to use for making the request.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI SQL"><pre tabindex="0" class="prism-code language-SQL codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT customer_id from `booking`</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="sample-configuration-2"></a>Sample Configuration<a class="hash-link" href="#sample-configuration-2" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_ENABLE = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_CONFIG = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;external_source&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;grpc&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;endpoint&quot;: &quot;localhost&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;service_port&quot;: &quot;5000&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;request_pattern&quot;: &quot;{&#x27;key&#x27;: %s}&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;request_variables&quot;: &quot;customer_id&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;grpc_stencil_url&quot;: &quot;http://localhost:9000/proto-descriptors/latest&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;grpc_request_proto_schema&quot;: &quot;io.grpc.test.Request&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;grpc_response_proto_schema&quot;: &quot;io.grpc.test.Response&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;grpc_method_url&quot;: &quot;testserver.test/ReturnResponse&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;stream_timeout&quot;: &quot;5000&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;connect_timeout&quot;: &quot;5000&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;fail_on_errors&quot;: &quot;false&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;capacity&quot;: &quot;30&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;headers&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;key&quot;: &quot;value&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;output_mapping&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;customer_profile&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;path&quot;: &quot;$._source&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="internal-post-processor"></a>Internal Post Processor<a class="hash-link" href="#internal-post-processor" title="Direct link to heading">#</a></h2><p>In order to enhance output with data that doesn’t need an external data store, you can use this configuration. At present, we support 3 types.</p><ul><li><strong>SQL</strong>: Data fields from the SQL query output. You could either use a specific field or <code>*</code> for all the fields. In case of selecting <code>*</code> you have the option to either map all fields to single output field or multiple output fields with the same name. Check the example in <a href="/dagger/docs/advance/post_processor#sample-configurations">sample configuration</a>.</li><li><strong>Constant</strong>: Constant value without any transformation.</li><li><strong>Function</strong>: Predefined functions (in Dagger) which will be evaluated at the time of event processing. At present, we support only the following 2 functions:<ol><li><code>CURRENT_TIMESTAMP</code>, which can be used to populate the latest timestamp.</li><li><code>JSON_PAYLOAD</code>, which can be used to get the entire incoming proto message as a JSON string. For this function to work correctly, ensure that the Dagger SQL outputs rows in the same format as the proto class specified in <code>internal_processor_config</code> field (check the function example in <a href="/dagger/docs/advance/post_processor#sample-configurations">sample configuration</a>).</li></ol></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="workflow-4"></a>Workflow<a class="hash-link" href="#workflow-4" title="Direct link to heading">#</a></h3><p>On applying only this post processor, dagger will perform the following operations on a single message in happy path</p><ul><li>Consume the message from configured Kafka stream.</li><li>Apply the SQL query configured.</li><li>Populate the provided <a href="/dagger/docs/advance/post_processor#output_field">output_field</a> with the <a href="/dagger/docs/advance/post_processor#value">value</a> depending upon the <a href="/dagger/docs/advance/post_processor#type">type</a>.</li><li>Push the populated message to configured sink.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="configuration-4"></a>Configuration<a class="hash-link" href="#configuration-4" title="Direct link to heading">#</a></h3><p>Following variables need to be configured as part of <a href="/dagger/docs/reference/configuration#processor_postprocessor_config">PROCESSOR_POSTPROCESSOR_CONFIG</a> JSON</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="output_field"></a><code>output_field</code><a class="hash-link" href="#output_field" title="Direct link to heading">#</a></h4><p>The field in output proto where this field should be populated.</p><ul><li>Example value: <code>event_timestamp</code></li><li>Type: <code>required</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="value"></a><code>value</code><a class="hash-link" href="#value" title="Direct link to heading">#</a></h4><p>The input data.</p><ul><li>Example value: <code>CURRENT_TIMESTAMP</code></li><li>Type: <code>required</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="type"></a><code>type</code><a class="hash-link" href="#type" title="Direct link to heading">#</a></h4><p>The type of internal post processor. This could be ‘SQL’, ‘constant’ or ‘function’ as explained above.</p><ul><li>Example value: <code>function</code></li><li>Type: <code>required</code></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="internal_processor_config"></a><code>internal_processor_config</code><a class="hash-link" href="#internal_processor_config" title="Direct link to heading">#</a></h4><p>The configuration argument needed to specify inputs for certain function type internal post processors. As of now, this is only required for <code>JSON_PAYLOAD</code> internal post processor.</p><ul><li>Example value: <code>{&quot;schema_proto_class&quot;: &quot;io.odpf.dagger.consumer.TestBookingLogMessage&quot;}</code></li><li>Type: <code>optional</code></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="sample-query-4"></a>Sample Query<a class="hash-link" href="#sample-query-4" title="Direct link to heading">#</a></h3><p>You can select the fields that you want to get from the input stream or you want to use for making the request.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI SQL"><pre tabindex="0" class="prism-code language-SQL codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * from `booking`</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="sample-configurations"></a>Sample Configurations<a class="hash-link" href="#sample-configurations" title="Direct link to heading">#</a></h3><p><strong>SQL</strong></p><p>This configuration will populate field <code>booking_log</code> with all the input fields selected in the SQL</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_ENABLE = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_CONFIG = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;internal_source&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;output_field&quot;: &quot;booking_log&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;sql&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;value&quot;: &quot;*&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In order to select all fields and map them to multiple fields with same name in the output proto</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_ENABLE = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_CONFIG = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;internal_source&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;output_field&quot;: &quot;*&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;sql&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;value&quot;: &quot;*&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>Constant</strong></p><p>This configuration will populate field <code>s2id_level</code> with value 13 for all the events</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_ENABLE = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_CONFIG = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;internal_source&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;output_field&quot;: &quot;s2id_level&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;constant&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;value&quot;: &quot;13&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>Function</strong></p><p>This configuration will populate field <code>event_timestamp</code> with a timestamp of when the event is processed.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">FLINK_SQL_QUERY=SELECT * from data_stream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_ENABLE = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_CONFIG = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;internal_source&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;output_field&quot;: &quot;event_timestamp&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;function&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;value&quot;: &quot;CURRENT_TIMESTAMP&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Similarly, the following configuration will fill the <code>json_payload</code> field with the complete output of SQL query, in JSON format.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">FLINK_SQL_QUERY=SELECT * from data_stream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_ENABLE = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">PROCESSOR_POSTPROCESSOR_CONFIG = {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;internal_source&quot;: [</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;output_field&quot;: &quot;json_payload&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;function&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;value&quot;: &quot;JSON_PAYLOAD&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;internal_processor_config&quot;: {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;schema_proto_class&quot;: &quot;io.odpf.dagger.consumer.TestBookingLogMessage&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="transformers"></a>Transformers<a class="hash-link" href="#transformers" title="Direct link to heading">#</a></h2><p>Transformers are the type of processors that let users define more complex processing capabilities by writing custom Java code. As this is a vast topic, we have covered it in detail <a href="/dagger/docs/guides/use_transformer">here</a>.</p><header><h1>Post Processor requirements</h1></header><p>Some basic information you need to know before the creation of a Post Processor Dagger is as follow</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="number-of-post-processors"></a>Number of Post Processors<a class="hash-link" href="#number-of-post-processors" title="Direct link to heading">#</a></h2><p>Any number of post processors can be chained in a single dagger for a given use-case. The post-processors could be of the same or different type. The initial SQL do not depend on the number of Post Processors and you can simply start with selecting as many fields that are required for the final result as well as the Post Processors in the SQL.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="throughput"></a>Throughput<a class="hash-link" href="#throughput" title="Direct link to heading">#</a></h2><p>The throughput depends on the input topic of Dagger and after SQL filtering, the enrichment store should be able to handle that load.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="output-proto"></a>Output Proto<a class="hash-link" href="#output-proto" title="Direct link to heading">#</a></h2><p>The output proto should have all the fields that you want to output from the input stream as well as fields getting enriched from the Post Processor with the correct data type.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="connectivity"></a>Connectivity<a class="hash-link" href="#connectivity" title="Direct link to heading">#</a></h2><p>The enrichment store should have connectivity to the Dagger deployment.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/odpf/dagger/edit/master/docs/docs/advance/post_processor.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/dagger/docs/advance/pre_processor"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Pre Processors</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/dagger/docs/advance/longbow"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Longbow »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#external-post-processor" class="table-of-contents__link">External Post Processor</a><ul><li><a href="#elasticsearch" class="table-of-contents__link"><strong>Elasticsearch</strong></a></li><li><a href="#http" class="table-of-contents__link"><strong>HTTP</strong></a></li><li><a href="#postgres" class="table-of-contents__link"><strong>Postgres</strong></a></li><li><a href="#grpc" class="table-of-contents__link"><strong>GRPC</strong></a></li></ul></li><li><a href="#internal-post-processor" class="table-of-contents__link">Internal Post Processor</a><ul><li><a href="#workflow-4" class="table-of-contents__link">Workflow</a></li><li><a href="#configuration-4" class="table-of-contents__link">Configuration</a></li><li><a href="#sample-query-4" class="table-of-contents__link">Sample Query</a></li><li><a href="#sample-configurations" class="table-of-contents__link">Sample Configurations</a></li></ul></li><li><a href="#transformers" class="table-of-contents__link">Transformers</a></li><li><a href="#number-of-post-processors" class="table-of-contents__link">Number of Post Processors</a></li><li><a href="#throughput" class="table-of-contents__link">Throughput</a></li><li><a href="#output-proto" class="table-of-contents__link">Output Proto</a></li><li><a href="#connectivity" class="table-of-contents__link">Connectivity</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Products</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/odpf/optimus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Optimus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/odpf/firehose" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Firehose<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/odpf/raccoon" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Raccoon<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/odpf/stencil" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stencil<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/dagger/docs/intro">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/dagger/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/dagger/help">Help</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://bit.ly/2RzPbtn" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/odpf/dagger" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/dagger/assets/js/runtime~main.7ce6ea11.js"></script>
<script src="/dagger/assets/js/main.ec596639.js"></script>
</body>
</html>